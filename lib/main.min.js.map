{"version":3,"file":"main.min.js","sources":["../src/main.ts"],"sourcesContent":["export type LocalStorageItem = {\n    data: any,\n    expiry: number | null\n};\n\nexport class LocalStorage {\n    /**\n     * Current Storage instance.\n     *\n     * @type { Storage }\n     */\n    static #storage: Storage = localStorage;\n\n    /**\n     * Default item validity period in seconds.\n     *\n     * @type { number | null }\n     */\n    static #ttl: number | null = null;\n\n    /**\n     * Set the default item validity period in seconds.\n     *\n     * @param { number | null } value\n     */\n    static ttl(value: number | null): void {\n        this.#ttl = value;\n    }\n\n    /**\n     * Set the key to the Storage object.\n     *\n     * @param { string } key String containing the name of the key you want to create.\n     * @param { * } value Value you want to give the key you are creating.\n     * @param { number | null } ttl Item validity period in seconds.\n     */\n    static set(key: string, value: any, ttl: number | null = null): void {\n        ttl = ttl ?? this.#ttl;\n\n        const item: LocalStorageItem = {\n            data  : typeof value === 'function' ? value() : value,\n            expiry: ttl ? Date.now() + ttl * 1000 : null\n        };\n\n        this.#storage.setItem(key, JSON.stringify(item));\n    }\n\n    /**\n     * Get the key from the Storage object.\n     *\n     * @param { string } key String containing the name of the key you want to create.\n     * @param { string | Function | null } fallback Fallback value in case the key does not exist.\n     *\n     * @return { * }\n     */\n    static get(key: string, fallback: string | Function | null = null): any {\n        const storageItem: string | null = this.#storage.getItem(key);\n\n        if (storageItem === null) {\n            return typeof fallback === 'function' ? fallback() : fallback;\n        }\n\n        try {\n            const item: LocalStorageItem = JSON.parse(storageItem);\n\n            if (item.expiry && Date.now() > item.expiry) {\n                this.remove(key);\n\n                return null;\n            }\n\n            return item.data ?? item;\n        } catch {\n            return storageItem;\n        }\n    }\n\n    /**\n     * Get the key from the Storage, or execute the given callback and store the result.\n     *\n     * @param { string } key String containing the name of the key you want to create.\n     * @param { Function } callback Function you want to execute.\n     * @param { number | null } ttl Item validity period in seconds.\n     *\n     * @return { any }\n     */\n    static remember(key: string, callback: Function, ttl: number | null = null): any {\n        const item: string | null = this.get(key);\n\n        if (item === null) {\n            this.set(key, callback, ttl ?? this.#ttl);\n        }\n\n        return item ?? this.get(key);\n    }\n\n    /**\n     * Retrieves all items from the Storage object.\n     *\n     * @return { { key: string, value: any }[] }\n     */\n    static all(): { key: string, value: any }[] {\n        return this.keys().map((key: string): { key: string, value: any } => {\n            return { key, value: this.get(key) };\n        });\n    }\n\n    /**\n     * Remove the key from the Storage object.\n     *\n     * @param { string } key String containing the name of the key you want to delete.\n     */\n    static remove(key: string): void {\n        this.#storage.removeItem(key);\n    }\n\n    /**\n     * Clear all keys stored in a given Storage object.\n     */\n    static clear(): void {\n        this.#storage.clear();\n    }\n\n    /**\n     * Determine if the key exists in the Storage object.\n     *\n     * @param { string } key String containing the name of the key you want to check against\n     *\n     * @return { boolean }\n     */\n    static has(key: string): boolean {\n        return !!this.get(key);\n    }\n\n    /**\n     * Determine if any of the keys exists in the Storage object.\n     *\n     * @param { string | string[] } keys String containing the name of the key you want to check against\n     *\n     * @return { boolean }\n     */\n    static hasAny(...keys: [string | string[]] | string[]): boolean {\n        if (keys.length === 1) {\n            if (Array.isArray(keys[0])) {\n                keys = keys[0];\n            } else {\n                keys = [keys[0]];\n            }\n        }\n\n        return keys.some((key: string): boolean => this.has(key));\n    }\n\n    /**\n     * Determine if the Storage object is empty.\n     *\n     * @return { boolean }\n     */\n    static isEmpty(): boolean {\n        return this.#storage.length === 0;\n    }\n\n    /**\n     * Determine if the Storage object is not empty.\n     *\n     * @return { boolean }\n     */\n    static isNotEmpty(): boolean {\n        return !this.isEmpty();\n    }\n\n    /**\n     * Retrieves all keys from the Storage object.\n     *\n     * @return { string[] }\n     */\n    static keys(): string[] {\n        return Object.keys(this.#storage);\n    }\n\n    /**\n     * Returns the total number of items in the Storage object.\n     *\n     * @return { number }\n     */\n    static count(): number {\n        return this.#storage.length;\n    }\n\n    /**\n     * Updates the item expiration time.\n     *\n     * @param { string } key String containing the name of the key you want to update.\n     * @param { number | null } ttl Item validity period in seconds.\n     */\n    static touch(key: string, ttl: number | null = null): void {\n        const item: any = this.get(key);\n\n        if (item === null) {\n            return;\n        }\n\n        this.set(key, item, ttl ?? this.#ttl);\n    }\n\n    /**\n     * Returns the expiration date for a given key.\n     *\n     * @param { string } key String containing the name of the key you want to check against\n     * @param { boolean } asDate If true, returns the expiration date as a Date object.\n     *\n     * @return { number | Date | null }\n     */\n    static expiry(key: string, asDate: boolean = false): number | Date | null {\n        const storageItem: string | null = this.#storage.getItem(key);\n\n        if (storageItem === null) {\n            return null;\n        }\n\n        try {\n            const item: LocalStorageItem | null = JSON.parse(storageItem);\n\n            if (item?.expiry === undefined || item?.expiry === null) {\n                return null;\n            }\n\n            return asDate ? new Date(item.expiry) : item.expiry;\n        } catch {\n            return null;\n        }\n    }\n\n    /**\n     * Dump the key from the Storage object.\n     *\n     * @param { string } key String containing the name of the key you want to dump.\n     */\n    static dump(key: string): void {\n        console.log(this.get(key));\n    }\n\n    /**\n     * Replace the Local Storage instance with a fake.\n     *\n     * @return { void }\n     */\n    static fake(): void {\n        this.#storage = new LocalStorageFake();\n    }\n\n    /**\n     * Restore the Local Storage instance.\n     *\n     * @return { void }\n     */\n    static restore(): void {\n        this.#storage = localStorage;\n    }\n\n    /**\n     * Determines whether a \"fake\" has been set as the Local Storage instance.\n     *\n     * @return { boolean }\n     */\n    static isFake(): boolean {\n        return this.#storage instanceof LocalStorageFake;\n    }\n}\n\nexport class LocalStorageFake implements Storage {\n    /**\n     * Storage property.\n     *\n     * @type { string }\n     */\n    [key: string]: any;\n\n    /**\n     * Returns an integer representing the number of data items stored in the Storage object.\n     *\n     * @return { number }\n     */\n    get length(): number {\n        return Object.keys(this).length;\n    }\n\n    /**\n     * When passed a key name, will return that key's value.\n     *\n     * @param { string } keyName\n     *\n     * @return { any }\n     */\n    getItem(keyName: string): string {\n        return this[keyName] || null;\n    }\n\n    /**\n     * When passed a key name and value, will add that key to the storage, or update that key's value if it already exists.\n     *\n     * @param { string } keyName\n     * @param { string } keyValue\n     *\n     * @return { void }\n     */\n    setItem(keyName: string, keyValue: string): void {\n        this[keyName] = keyValue;\n    }\n\n    /**\n     * When passed a key name, will remove that key from the storage.\n     *\n     * @param { string } keyName\n     *\n     * @return { void }\n     */\n    removeItem(keyName: string): void {\n        delete this[keyName];\n    }\n\n    /**\n     * When invoked, will empty all keys out of the storage.\n     *\n     * @return { void }\n     */\n    clear(): void {\n        for (const key of Object.keys(this)) {\n            delete this[key];\n        }\n    }\n\n    /**\n     * When passed a number n, returns the name of the nth key in a given Storage object.\n     *\n     * @param { number } index\n     *\n     * @return { string | null }\n     */\n    key(index: number): string | null {\n        return Object.keys(this)[index] ?? null;\n    }\n}\n\nif (typeof window !== 'undefined') {\n    (window as any).LocalStorage = LocalStorage;\n    (window as any).LocalStorageFake = LocalStorageFake;\n}\n\nif (typeof global !== 'undefined') {\n    (global as any).LocalStorage = LocalStorage;\n    (global as any).LocalStorageFake = LocalStorageFake;\n}"],"names":["LocalStorage","ttl","value","__classPrivateFieldSet","this","_a","_LocalStorage_ttl","set","key","__classPrivateFieldGet","item","data","expiry","Date","now","_LocalStorage_storage","setItem","JSON","stringify","get","fallback","storageItem","getItem","parse","remove","_b","_c","remember","callback","all","keys","map","removeItem","clear","has","hasAny","length","Array","isArray","some","isEmpty","isNotEmpty","Object","count","touch","asDate","undefined","dump","console","log","fake","LocalStorageFake","restore","localStorage","isFake","keyName","keyValue","index","window","global"],"mappings":"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"}