{"version":3,"file":"main.min.js","sources":["../src/storage/LocalStorageFake.ts","../src/events/StorageFlushing.ts","../src/events/StorageFlushed.ts","../src/events/RetrievingKey.ts","../src/events/KeyHit.ts","../src/events/KeyMissed.ts","../src/events/KeyWriteFailed.ts","../src/events/KeyWritten.ts","../src/events/WritingKey.ts","../src/events/KeyForgotten.ts","../src/events/KeyForgotFailed.ts","../src/storage/LocalStorage.ts"],"sourcesContent":["export class LocalStorageFake implements Storage {\r\n    /**\r\n     * Current used storage in bytes.\r\n     *\r\n     * @type { number }\r\n     */\r\n    #used: number = 0;\r\n\r\n    /**\r\n     * Maximum storage quota (5MB for most modern browsers).\r\n     *\r\n     * @type { number }\r\n     */\r\n    #quota: number = 5 * 1024 * 1024;\r\n\r\n    /**\r\n     * Storage property.\r\n     *\r\n     * @type { string }\r\n     */\r\n    [key: string]: any;\r\n\r\n    /**\r\n     * Create a new Storage instance.\r\n     */\r\n    constructor() {\r\n        this.#used = this.space();\r\n    }\r\n\r\n    /**\r\n     * Returns an integer representing the number of data items stored in the Storage object.\r\n     *\r\n     * @return { number }\r\n     */\r\n    get length(): number {\r\n        return Object.keys(this).length;\r\n    }\r\n\r\n    /**\r\n     * When passed a key name, will return that key's value.\r\n     *\r\n     * @param { string } keyName\r\n     *\r\n     * @return { any }\r\n     */\r\n    getItem(keyName: string): string {\r\n        return this[keyName] || null;\r\n    }\r\n\r\n    /**\r\n     * When passed a key name and value, will add that key to the storage, or update that key's value if it already exists.\r\n     *\r\n     * @param { string } keyName\r\n     * @param { string } keyValue\r\n     *\r\n     * @return { void }\r\n     */\r\n    setItem(keyName: string, keyValue: string): void {\r\n        const value: string = String(keyValue);\r\n\r\n        if (this.exceeded(keyName, value)) {\r\n            this.throw(keyName);\r\n        }\r\n\r\n        this[keyName] = value;\r\n\r\n        this.#used = this.space();\r\n    }\r\n\r\n    /**\r\n     * When passed a key name, will remove that key from the storage.\r\n     *\r\n     * @param { string } keyName\r\n     *\r\n     * @return { void }\r\n     */\r\n    removeItem(keyName: string): void {\r\n        delete this[keyName];\r\n\r\n        this.#used = this.space();\r\n    }\r\n\r\n    /**\r\n     * When invoked, will empty all keys out of the storage.\r\n     *\r\n     * @return { void }\r\n     */\r\n    clear(): void {\r\n        for (const key of Object.keys(this)) {\r\n            delete this[key];\r\n        }\r\n\r\n        this.#used = this.space();\r\n    }\r\n\r\n    /**\r\n     * When passed a number n, returns the name of the nth key in a given Storage object.\r\n     *\r\n     * @param { number } index\r\n     *\r\n     * @return { string | null }\r\n     */\r\n    key(index: number): string | null {\r\n        return Object.keys(this)[index] ?? null;\r\n    }\r\n\r\n    /**\r\n     * Calculate current used storage space in bytes.\r\n     *\r\n     * @return { number }\r\n     */\r\n    private space(): number {\r\n        this.#used = 0;\r\n\r\n        for (const key of Object.keys(this)) {\r\n            this.#used += this.size(key, this[key]);\r\n        }\r\n\r\n        return this.#used;\r\n    }\r\n\r\n    /**\r\n     * Calculate the size a new item would take in bytes.\r\n     *\r\n     * @param { string } keyName\r\n     * @param { string } keyValue\r\n     *\r\n     * @return { number }\r\n     */\r\n    private size(keyName: string, keyValue: string): number {\r\n        return new Blob([keyName, keyValue]).size;\r\n    }\r\n\r\n    /**\r\n     * Determine if the Storage quota is exceeded.\r\n     *\r\n     * @param { string } keyName\r\n     * @param { string } keyValue\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    private exceeded(keyName: string, keyValue: string): boolean {\r\n        return this.size(keyName, keyValue) + this.#used > this.#quota;\r\n    }\r\n\r\n    /**\r\n     * Throws an error in case the Storage quota is exceeded.\r\n     *\r\n     * @param { string } keyName\r\n     *\r\n     * @return { void }\r\n     */\r\n    private throw(keyName: string): void {\r\n        throw new DOMException(`Failed to execute 'setItem' on 'Storage': Setting the value of '${keyName}' exceeded the quota.`, 'QuotaExceededError');\r\n    }\r\n}","export class StorageFlushing extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * Create a new Storage Flushing Event instance.\r\n     */\r\n    constructor() {\r\n        super('local-storage:flushing');\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n}\r\n","export class StorageFlushed extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * Create a new Storage Flushed Event instance.\r\n     */\r\n    constructor() {\r\n        super('local-storage:flushed');\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n}\r\n","export class RetrievingKey extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * Create a new Retrieving Key Event instance.\r\n     *\r\n     * @param { string } key\r\n     */\r\n    constructor(key: string) {\r\n        super('local-storage:retrieving');\r\n\r\n        this.#key = key;\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n}\r\n","export class KeyHit extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * The value of the key.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #value: string;\r\n\r\n    /**\r\n     * Create a new Key Hit Event instance.\r\n     *\r\n     * @param { string } key\r\n     * @param { string } value\r\n     */\r\n    constructor(key: string, value: any) {\r\n        super('local-storage:hit');\r\n\r\n        this.#key = key;\r\n        this.#value = value;\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n\r\n    /**\r\n     * Get the value of the key.\r\n     *\r\n     * @return { * }\r\n     */\r\n    get value(): any {\r\n        return this.#value;\r\n    }\r\n}\r\n","export class KeyMissed extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * Create a new Key Missed Event instance.\r\n     *\r\n     * @param { string } key\r\n     */\r\n    constructor(key: string) {\r\n        super('local-storage:missed');\r\n\r\n        this.#key = key;\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n}\r\n","export class KeyWriteFailed extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * The value of the key.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #value: string;\r\n\r\n    /**\r\n     * The validity period in seconds since Unix Epoch.\r\n     *\r\n     * @type { number | number }\r\n     */\r\n    readonly #expiry: number | null;\r\n\r\n    /**\r\n     * Create a new Key Write Failed Event instance.\r\n     *\r\n     * @param { string } key\r\n     * @param { string } value\r\n     * @param { number | null } expiry\r\n     */\r\n    constructor(key: string, value: any, expiry: number | null = null) {\r\n        super('local-storage:write-failed');\r\n\r\n        this.#key = key;\r\n        this.#value = value;\r\n        this.#expiry = expiry;\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n\r\n    /**\r\n     * Get the value of the key.\r\n     *\r\n     * @return { * }\r\n     */\r\n    get value(): any {\r\n        return this.#value;\r\n    }\r\n\r\n    /**\r\n     * Get the validity period in milliseconds since Unix Epoch.\r\n     *\r\n     * @return { number | null }\r\n     */\r\n    get expiry(): number | null {\r\n        return this.#expiry;\r\n    }\r\n}\r\n","export class KeyWritten extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * The value of the key.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #value: string;\r\n\r\n    /**\r\n     * The validity period in seconds since Unix Epoch.\r\n     *\r\n     * @type { number | number }\r\n     */\r\n    readonly #expiry: number | null;\r\n\r\n    /**\r\n     * Create a new Key Written Event instance.\r\n     *\r\n     * @param { string } key\r\n     * @param { string } value\r\n     * @param { number | null} expiry\r\n     */\r\n    constructor(key: string, value: any, expiry: number | null = null) {\r\n        super('local-storage:written');\r\n\r\n        this.#key = key;\r\n        this.#value = value;\r\n        this.#expiry = expiry;\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n\r\n    /**\r\n     * Get the value of the key.\r\n     *\r\n     * @return { * }\r\n     */\r\n    get value(): any {\r\n        return this.#value;\r\n    }\r\n\r\n    /**\r\n     * Get the validity period in milliseconds since Unix Epoch.\r\n     *\r\n     * @return { number | null }\r\n     */\r\n    get expiry(): number | null {\r\n        return this.#expiry;\r\n    }\r\n}\r\n","export class WritingKey extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * The value of the key.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #value: string;\r\n\r\n    /**\r\n     * The validity period in seconds since Unix Epoch.\r\n     *\r\n     * @type { number | number }\r\n     */\r\n    readonly #expiry: number | null;\r\n\r\n    /**\r\n     * Create a new Writing Key Event instance.\r\n     *\r\n     * @param { string } key\r\n     * @param { string } value\r\n     * @param { number | null} expiry\r\n     */\r\n    constructor(key: string, value: any, expiry: number | null = null) {\r\n        super('local-storage:writing');\r\n\r\n        this.#key = key;\r\n        this.#value = value;\r\n        this.#expiry = expiry;\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n\r\n    /**\r\n     * Get the value of the key.\r\n     *\r\n     * @return { * }\r\n     */\r\n    get value(): any {\r\n        return this.#value;\r\n    }\r\n\r\n    /**\r\n     * Get the validity period in milliseconds since Unix Epoch.\r\n     *\r\n     * @return { number | null }\r\n     */\r\n    get expiry(): number | null {\r\n        return this.#expiry;\r\n    }\r\n}\r\n","export class KeyForgotten extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * Create a new Key Forgotten Event instance.\r\n     *\r\n     * @param { string } key\r\n     */\r\n    constructor(key: string) {\r\n        super('local-storage:forgot');\r\n\r\n        this.#key = key;\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n}\r\n","export class KeyForgotFailed extends Event {\r\n    /**\r\n     * The key of the event.\r\n     *\r\n     * @type { string }\r\n     */\r\n    readonly #key: string;\r\n\r\n    /**\r\n     * Create a new Key Forgot Failed Event instance.\r\n     *\r\n     * @param { string } key\r\n     */\r\n    constructor(key: string) {\r\n        super('local-storage:forgot-failed');\r\n\r\n        this.#key = key;\r\n    }\r\n\r\n    /**\r\n     * Get the key of the event.\r\n     *\r\n     * @return { string }\r\n     */\r\n    get key(): string {\r\n        return this.#key;\r\n    }\r\n}\r\n","import { LocalStorageFake } from './LocalStorageFake';\r\nimport {\r\n    KeyForgotFailed,\r\n    KeyForgotten,\r\n    KeyHit,\r\n    KeyMissed,\r\n    KeyWriteFailed,\r\n    KeyWritten,\r\n    type LocalStorageEvent,\r\n    type LocalStorageEventListener,\r\n    type LocalStorageEvents,\r\n    RetrievingKey,\r\n    StorageFlushed,\r\n    StorageFlushing,\r\n    WritingKey,\r\n} from '../events';\r\n\r\nexport type LocalStorageItem = {\r\n    data: any,\r\n    expiry: number | null\r\n};\r\n\r\nexport class LocalStorage {\r\n    /**\r\n     * Current Storage instance.\r\n     *\r\n     * @type { Storage }\r\n     */\r\n    static #storage: Storage = localStorage;\r\n\r\n    /**\r\n     * Item validity period in seconds.\r\n     *\r\n     * @type { number | null }\r\n     */\r\n    static #ttl: number | null = null;\r\n\r\n    /**\r\n     * Set the default item validity period in seconds.\r\n     *\r\n     * @param { number | null } value\r\n     *\r\n     * @return { void }\r\n     */\r\n    static ttl(value: number | null): void {\r\n        this.#ttl = value;\r\n    }\r\n\r\n    /**\r\n     * Set the key to the Storage object.\r\n     *\r\n     * @param { string } key\r\n     * @param { * } value\r\n     * @param { number | null } ttl\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    static set(key: string, value: any, ttl: number | null = null): boolean {\r\n        ttl = ttl ?? this.#ttl;\r\n\r\n        const item: LocalStorageItem = {\r\n            data  : typeof value === 'function' ? value() : value,\r\n            expiry: ttl ? Date.now() + ttl * 1000 : null\r\n        };\r\n\r\n        this.emit(new WritingKey(key, item.data, item.expiry));\r\n\r\n        try {\r\n            this.#storage.setItem(key, JSON.stringify(item));\r\n\r\n            this.emit(new KeyWritten(key, item.data, item.expiry));\r\n        } catch {\r\n            this.emit(new KeyWriteFailed(key, item.data, item.expiry));\r\n\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Get the key from the Storage object.\r\n     *\r\n     * @param { string } key\r\n     * @param { string | Function | null } fallback\r\n     *\r\n     * @return { * }\r\n     */\r\n    static get(key: string, fallback: string | Function | null = null): any {\r\n        this.emit(new RetrievingKey(key));\r\n\r\n        const storageItem: string | null = this.#storage.getItem(key);\r\n\r\n        if (storageItem === null) {\r\n            this.emit(new KeyMissed(key));\r\n\r\n            return typeof fallback === 'function' ? fallback() : fallback;\r\n        }\r\n\r\n        let value: any;\r\n\r\n        try {\r\n            const item: LocalStorageItem = JSON.parse(storageItem);\r\n\r\n            if (item.expiry && Date.now() > item.expiry) {\r\n                this.remove(key);\r\n\r\n                return null;\r\n            }\r\n\r\n            value = item.data ?? item;\r\n        } catch {\r\n            value = storageItem;\r\n        }\r\n\r\n        this.emit(new KeyHit(key, value));\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Get the key from the Storage, or execute the given callback and store the result.\r\n     *\r\n     * @param { string } key\r\n     * @param { Function } callback\r\n     * @param { number | null } ttl\r\n     *\r\n     * @return { any }\r\n     */\r\n    static remember(key: string, callback: Function, ttl: number | null = null): any {\r\n        const item: string | null = this.get(key);\r\n\r\n        if (item === null) {\r\n            this.set(key, callback, ttl ?? this.#ttl);\r\n        }\r\n\r\n        return item ?? this.get(key);\r\n    }\r\n\r\n    /**\r\n     * Retrieves all items from the Storage object.\r\n     *\r\n     * @return { { key: string, value: any }[] }\r\n     */\r\n    static all(): { key: string, value: any }[] {\r\n        return this.keys().map((key: string): { key: string, value: any } => {\r\n            return { key, value: this.get(key) };\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Remove the key from the Storage object.\r\n     *\r\n     * @param { string } key\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    static remove(key: string): boolean {\r\n        if (this.has(key)) {\r\n            this.#storage.removeItem(key);\r\n\r\n            this.emit(new KeyForgotten(key));\r\n\r\n            return true;\r\n        } else {\r\n            this.emit(new KeyForgotFailed(key));\r\n\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all keys stored in a given Storage object.\r\n     *\r\n     * @return { void }\r\n     */\r\n    static clear(): void {\r\n        this.emit(new StorageFlushing());\r\n\r\n        this.#storage.clear();\r\n\r\n        this.emit(new StorageFlushed());\r\n    }\r\n\r\n    /**\r\n     * Determine if the key exists in the Storage object.\r\n     *\r\n     * @param { string } key\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    static has(key: string): boolean {\r\n        return !!this.get(key);\r\n    }\r\n\r\n    /**\r\n     * Determine if the key does not exist in the Storage object.\r\n     *\r\n     * @param { string } key\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    static missing(key: string): boolean {\r\n        return !this.has(key);\r\n    }\r\n\r\n    /**\r\n     * Determine if any of the keys exists in the Storage object.\r\n     *\r\n     * @param { string | string[] } keys\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    static hasAny(...keys: [string | string[]] | string[]): boolean {\r\n        if (keys.length === 1) {\r\n            if (Array.isArray(keys[0])) {\r\n                keys = keys[0];\r\n            } else {\r\n                keys = [keys[0]];\r\n            }\r\n        }\r\n\r\n        return keys.some((key: string): boolean => this.has(key));\r\n    }\r\n\r\n    /**\r\n     * Determine if the Storage object is empty.\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    static isEmpty(): boolean {\r\n        return this.#storage.length === 0;\r\n    }\r\n\r\n    /**\r\n     * Determine if the Storage object is not empty.\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    static isNotEmpty(): boolean {\r\n        return !this.isEmpty();\r\n    }\r\n\r\n    /**\r\n     * Retrieves all keys from the Storage object.\r\n     *\r\n     * @return { string[] }\r\n     */\r\n    static keys(): string[] {\r\n        return Object.keys(this.#storage);\r\n    }\r\n\r\n    /**\r\n     * Returns the total number of items in the Storage object.\r\n     *\r\n     * @return { number }\r\n     */\r\n    static count(): number {\r\n        return this.#storage.length;\r\n    }\r\n\r\n    /**\r\n     * Updates the item expiration time.\r\n     *\r\n     * @param { string } key\r\n     * @param { number | null } ttl\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    static touch(key: string, ttl: number | null = null): boolean {\r\n        const item: any = this.get(key);\r\n\r\n        if (item === null) {\r\n            return false;\r\n        }\r\n\r\n        return this.set(key, item, ttl ?? this.#ttl);\r\n    }\r\n\r\n    /**\r\n     * Returns the expiration date for a given key.\r\n     *\r\n     * @param { string } key\r\n     *\r\n     * @return { Date | null }\r\n     */\r\n    static expiry(key: string): Date | null {\r\n        const storageItem: string | null = this.#storage.getItem(key);\r\n\r\n        if (storageItem === null) {\r\n            return null;\r\n        }\r\n\r\n        try {\r\n            const item: LocalStorageItem | null = JSON.parse(storageItem);\r\n\r\n            if (item === null || item.expiry === undefined || item.expiry === null) {\r\n                return null;\r\n            }\r\n\r\n            return new Date(item.expiry);\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dump the key from the Storage object.\r\n     *\r\n     * @param { string } key\r\n     */\r\n    static dump(key: string): void {\r\n        console.log(this.get(key));\r\n    }\r\n\r\n    /**\r\n     * Replace the Local Storage instance with a fake.\r\n     *\r\n     * @return { void }\r\n     */\r\n    static fake(): void {\r\n        this.#storage = new LocalStorageFake();\r\n    }\r\n\r\n    /**\r\n     * Restore the Local Storage instance.\r\n     *\r\n     * @return { void }\r\n     */\r\n    static restore(): void {\r\n        this.#storage = localStorage;\r\n    }\r\n\r\n    /**\r\n     * Determines whether a \"fake\" has been set as the Local Storage instance.\r\n     *\r\n     * @return { boolean }\r\n     */\r\n    static isFake(): boolean {\r\n        return this.#storage instanceof LocalStorageFake;\r\n    }\r\n\r\n    /**\r\n     * Register an event listener.\r\n     *\r\n     * @template { keyof LocalStorageEvents } K\r\n     *\r\n     * @param { K | LocalStorageEvents } events\r\n     * @param { LocalStorageEventListener<K> | null } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static listen(events: 'retrieving', listener: (event: RetrievingKey) => void): void;\r\n    static listen(events: 'hit', listener: (event: KeyHit) => void): void;\r\n    static listen(events: 'missed', listener: (event: KeyMissed) => void): void;\r\n    static listen(events: 'writing', listener: (event: WritingKey) => void): void;\r\n    static listen(events: 'written', listener: (event: KeyWritten) => void): void;\r\n    static listen(events: 'write-failed', listener: (event: KeyWriteFailed) => void): void;\r\n    static listen(events: 'forgot', listener: (event: KeyForgotten) => void): void;\r\n    static listen(events: 'forgot-failed', listener: (event: KeyForgotFailed) => void): void;\r\n    static listen(events: 'flushing', listener: (event: StorageFlushing) => void): void;\r\n    static listen(events: 'flushed', listener: (event: StorageFlushed) => void): void;\r\n    static listen(events: LocalStorageEvents): void;\r\n    static listen<K extends keyof LocalStorageEvent>(events: keyof LocalStorageEvent, listener: LocalStorageEventListener<K>): void;\r\n    static listen<K extends keyof LocalStorageEvent>(events: keyof LocalStorageEvent | LocalStorageEvents, listener: LocalStorageEventListener<K> | null = null): void {\r\n        events = typeof events === 'string' ? { [events]: listener } : events;\r\n\r\n        for (const [event, listener] of Object.entries(events)) {\r\n            addEventListener(`local-storage:${event}`, listener as EventListener, { once: true });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"retrieving\" event.\r\n     *\r\n     * @param { (event: RetrievingKey) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onRetrieving(listener: (event: RetrievingKey) => void): void {\r\n        this.listen('retrieving', listener);\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"hit\" event.\r\n     *\r\n     * @param { (event: KeyHit) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onHit(listener: (event: KeyHit) => void): void {\r\n        this.listen('hit', listener);\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"missed\" event.\r\n     *\r\n     * @param { (event: KeyMissed) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onMissed(listener: (event: KeyMissed) => void): void {\r\n        this.listen('missed', listener);\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"writing\" event.\r\n     *\r\n     * @param { (event: WritingKey) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onWriting(listener: (event: WritingKey) => void): void {\r\n        this.listen('writing', listener);\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"written\" event.\r\n     *\r\n     * @param { (event: KeyWritten) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onWritten(listener: (event: KeyWritten) => void): void {\r\n        this.listen('written', listener);\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"failed\" event.\r\n     *\r\n     * @param { (event: KeyWriteFailed) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onWriteFailed(listener: (event: KeyWriteFailed) => void): void {\r\n        this.listen('write-failed', listener);\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"forgot\" event.\r\n     *\r\n     * @param { (event: KeyForgotten) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onForgot(listener: (event: KeyForgotten) => void): void {\r\n        this.listen('forgot', listener);\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"forgot-failed\" event.\r\n     *\r\n     * @param { (event: KeyForgotFailed) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onForgotFailed(listener: (event: KeyForgotFailed) => void): void {\r\n        this.listen('forgot-failed', listener);\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"flushing\" event.\r\n     *\r\n     * @param { (event: StorageFlushing) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onFlushing(listener: (event: StorageFlushing) => void): void {\r\n        this.listen('flushing', listener);\r\n    }\r\n\r\n    /**\r\n     * Register a listener on \"flushed\" event.\r\n     *\r\n     * @param { (event: StorageFlushed) => void } listener\r\n     *\r\n     * @return { void }\r\n     */\r\n    static onFlushed(listener: (event: StorageFlushed) => void): void {\r\n        this.listen('flushed', listener);\r\n    }\r\n\r\n    /**\r\n     * Emit an event for the Local Storage instance.\r\n     *\r\n     * @template { keyof LocalStorageEvents } K\r\n     *\r\n     * @param { LocalStorageEvent[K] } event\r\n     *\r\n     * @returns { void }\r\n     */\r\n    private static emit<K extends keyof LocalStorageEvent>(event: LocalStorageEvent[K]): void {\r\n        dispatchEvent(event);\r\n    }\r\n}\r\n"],"names":["LocalStorageFake","constructor","_LocalStorageFake_used","set","this","_LocalStorageFake_quota","__classPrivateFieldSet","space","length","Object","keys","getItem","keyName","setItem","keyValue","value","String","exceeded","throw","removeItem","clear","key","index","_a","__classPrivateFieldGet","size","Blob","DOMException","StorageFlushing","Event","super","_StorageFlushing_key","StorageFlushed","_StorageFlushed_key","RetrievingKey","_RetrievingKey_key","KeyHit","_KeyHit_key","_KeyHit_value","KeyMissed","_KeyMissed_key","KeyWriteFailed","expiry","_KeyWriteFailed_key","_KeyWriteFailed_value","_KeyWriteFailed_expiry","KeyWritten","_KeyWritten_key","_KeyWritten_value","_KeyWritten_expiry","WritingKey","_WritingKey_key","_WritingKey_value","_WritingKey_expiry","KeyForgotten","_KeyForgotten_key","KeyForgotFailed","_KeyForgotFailed_key","LocalStorage","ttl","_LocalStorage_ttl","item","data","Date","now","emit","_LocalStorage_storage","JSON","stringify","_b","get","fallback","storageItem","parse","remove","_c","remember","callback","all","map","has","missing","hasAny","Array","isArray","some","isEmpty","isNotEmpty","count","touch","undefined","dump","console","log","fake","restore","localStorage","isFake","listen","events","listener","event","entries","addEventListener","once","onRetrieving","onHit","onMissed","onWriting","onWritten","onWriteFailed","onForgot","onForgotFailed","onFlushing","onFlushed","dispatchEvent"],"mappings":"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"}